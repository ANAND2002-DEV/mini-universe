<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Universe</title>
<style>
body{margin:0;overflow:hidden;background:black}
canvas{display:block}
</style>
</head>
<body>

<script type="module">
import * as THREE from "./three/three.module.min.js";

/* ================= BASIC ================= */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,20000);
camera.position.set(0,40,140);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.outputEncoding=THREE.sRGBEncoding;
renderer.toneMapping=THREE.ACESFilmicToneMapping;
document.body.appendChild(renderer.domElement);

/* ================= LIGHT ================= */
scene.add(new THREE.PointLight(0xffffff,200,0,2));
scene.add(new THREE.AmbientLight(0xffffff,0.7));

/* ================= STARS ================= */
const starsGeo=new THREE.BufferGeometry();
const stars=[];
for(let i=0;i<12000;i++){
  stars.push(
    (Math.random()-0.5)*10000,
    (Math.random()-0.5)*10000,
    (Math.random()-0.5)*10000
  );
}
starsGeo.setAttribute("position",new THREE.Float32BufferAttribute(stars,3));
scene.add(new THREE.Points(
  starsGeo,
  new THREE.PointsMaterial({size:1.2,color:0xffffff})
));

/* ================= TEXTURES ================= */
const loader=new THREE.TextureLoader();

/* ================= SUN ================= */
const sun=new THREE.Mesh(
  new THREE.SphereGeometry(9,64,64),
  new THREE.MeshBasicMaterial({map:loader.load("./assets/planets/sun.jpg")})
);
scene.add(sun);

/* ================= PLANETS ================= */
const data=[
 {n:"Mercury",s:1.2,d:18,sp:0.0009,t:"mercury.jpg"},
 {n:"Venus",s:1.7,d:24,sp:0.0007,t:"venus.jpg"},
 {n:"Earth",s:1.9,d:30,sp:0.0006,t:"earth.jpg",m:1},
 {n:"Mars",s:1.5,d:36,sp:0.0005,t:"mars.jpg"},
 {n:"Jupiter",s:3.5,d:50,sp:0.0003,t:"jupiter.jpg",m:4},
 {n:"Saturn",s:3.1,d:65,sp:0.00025,t:"saturn.jpg",m:3},
 {n:"Uranus",s:2.6,d:80,sp:0.0002,t:"uranus.jpg"},
 {n:"Neptune",s:2.6,d:95,sp:0.00015,t:"neptune.jpg"},
 {n:"Pluto",s:1.2,d:110,sp:0.0001,t:"pluto.jpg"},
 {n:"Exoplanet",s:2.2,d:130,sp:0.00008,t:"exoplanet.jpg"}
];

const planets=[];

data.forEach(p=>{
  const ring=new THREE.Mesh(
    new THREE.RingGeometry(p.d-0.15,p.d+0.15,128),
    new THREE.MeshBasicMaterial({color:0xffffff,opacity:0.16,transparent:true})
  );
  ring.rotation.x=Math.PI/2;
  scene.add(ring);

  const pivot=new THREE.Object3D();
  pivot.rotation.y=Math.random()*Math.PI*2;
  scene.add(pivot);

  const planet=new THREE.Mesh(
    new THREE.SphereGeometry(p.s,48,48),
    new THREE.MeshStandardMaterial({
      map:loader.load("./assets/planets/"+p.t),
      emissive:0x333333,
      emissiveIntensity:0.6
    })
  );
  planet.position.x=p.d;
  pivot.add(planet);

  /* moons */
  const moons=[];
  if(p.m){
    for(let i=0;i<p.m;i++){
      const mp=new THREE.Object3D();
      planet.add(mp);
      const moon=new THREE.Mesh(
        new THREE.SphereGeometry(p.s*0.18,24,24),
        new THREE.MeshStandardMaterial({color:0xffffff})
      );
      moon.position.x=p.s*(2+i*0.7);
      mp.add(moon);
      moons.push(mp);
    }
  }

  planets.push({pivot,planet,moons,speed:p.sp});
});

/* ================= ASTEROID BELT ================= */
const belt=new THREE.Group();
for(let i=0;i<600;i++){
  const rock=new THREE.Mesh(
    new THREE.SphereGeometry(Math.random()*0.15+0.05,8,8),
    new THREE.MeshStandardMaterial({color:0x888888})
  );
  const r=56+Math.random()*8;
  const a=Math.random()*Math.PI*2;
  rock.position.set(Math.cos(a)*r,(Math.random()-0.5)*2,Math.sin(a)*r);
  belt.add(rock);
}
scene.add(belt);

/* ================= SHOOTING STARS ================= */
const shooters=[];
function spawnShooter(){
  const geo=new THREE.BufferGeometry();
  geo.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,-6,0,0],3));
  const line=new THREE.Line(
    geo,
    new THREE.LineBasicMaterial({color:0xffffff,transparent:true,opacity:0.8})
  );
  line.position.set(
    (Math.random()-0.5)*800,
    (Math.random()-0.5)*400,
    (Math.random()-0.5)*800
  );
  line.userData={life:0,vel:new THREE.Vector3(
    Math.random()*-2-1,
    Math.random()*-1,
    Math.random()*-2-1
  )};
  scene.add(line);
  shooters.push(line);
}

/* ================= COMET ================= */
let comet=null;
function spawnComet(){
  const head=new THREE.Mesh(
    new THREE.SphereGeometry(0.6,16,16),
    new THREE.MeshBasicMaterial({color:0xffffff})
  );
  head.position.set(-600,Math.random()*200-100,Math.random()*200-100);

  const tailGeo=new THREE.BufferGeometry();
  const pos=[];
  for(let i=0;i<40;i++) pos.push(-i*0.5,0,0);
  tailGeo.setAttribute("position",new THREE.Float32BufferAttribute(pos,3));

  const tail=new THREE.Line(
    tailGeo,
    new THREE.LineBasicMaterial({color:0x88ccff,opacity:0.6,transparent:true})
  );
  head.add(tail);

  head.userData={vel:new THREE.Vector3(2,0.1,1)};
  scene.add(head);
  comet=head;
}

/* ================= ANIMATE ================= */
let t=0;
function animate(){
  requestAnimationFrame(animate);
  t++;

  sun.rotation.y+=0.00025;
  planets.forEach(p=>{
    p.pivot.rotation.y+=p.speed;
    p.planet.rotation.y+=0.0007;
    p.moons.forEach((m,i)=>m.rotation.y+=0.001+i*0.0004);
  });

  belt.rotation.y+=0.0002;

  if(Math.random()<0.01 && shooters.length<6) spawnShooter();
  shooters.forEach((s,i)=>{
    s.position.add(s.userData.vel);
    s.material.opacity-=0.02;
    if(s.material.opacity<=0){
      scene.remove(s);
      shooters.splice(i,1);
    }
  });

  if(!comet && Math.random()<0.002) spawnComet();
  if(comet){
    comet.position.add(comet.userData.vel);
    if(comet.position.x>600){
      scene.remove(comet);
      comet=null;
    }
  }

  renderer.render(scene,camera);
}
animate();

/* ================= RESIZE ================= */
addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
