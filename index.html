<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Universe â€” MAIN HTML</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:black;
  font-family:Arial,sans-serif;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.modal-card{
  background:#0b0b0b;
  border-radius:16px;
  padding:22px;
  max-width:520px;
  color:#fff;
  text-align:center;
  box-shadow:0 0 40px rgba(0,0,0,0.7);
}
.modal-card img,
.modal-card video{
  width:100%;
  border-radius:12px;
}
.close-btn{
  margin-top:12px;
  cursor:pointer;
  opacity:0.85;
}
.close-btn:hover{opacity:1;}
#sunModal .modal-card{
  border:1px solid rgba(255,200,80,0.5);
  color:#ffd27d;
}
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
  }
}
</script>
</head>

<body>

<!-- ðŸŒž SUN -->
<div id="sunModal" class="modal">
  <div class="modal-card">
    <h2>ðŸŒž Our First Meeting</h2>
    <p id="meetingText"></p>
    <div class="close-btn" onclick="closeAll()">Close</div>
  </div>
</div>

<!-- ðŸª PLANET PHOTO -->
<div id="planetModal" class="modal">
  <div class="modal-card">
    <h2 id="planetTitle"></h2>
    <img id="planetImg">
    <div class="close-btn" onclick="closeAll()">Close</div>
  </div>
</div>

<!-- ðŸŽ¬ VIDEO -->
<div id="videoModal" class="modal">
  <div class="modal-card">
    <video id="videoPlayer" controls autoplay></video>
    <div class="close-btn" onclick="closeAll()">Close</div>
  </div>
</div>

<script type="module">
import * as THREE from "three";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js";

/* ================= AUDIO ================= */
let currentAudio=null;
function playAudio(src){
  stopAudio();
  currentAudio=new Audio(src);
  currentAudio.loop=true;
  currentAudio.volume=0.7;
  currentAudio.play();
}
function stopAudio(){
  if(currentAudio){
    currentAudio.pause();
    currentAudio.currentTime=0;
    currentAudio=null;
  }
}

/* ================= VIDEO ================= */
const videoModal=document.getElementById("videoModal");
const videoPlayer=document.getElementById("videoPlayer");
function playVideo(src){
  closeAll();
  videoPlayer.src=src;
  videoModal.style.display="flex";
  videoPlayer.play();
}
function stopVideo(){
  videoPlayer.pause();
  videoPlayer.currentTime=0;
  videoPlayer.src="";
}

/* ================= SUN MEMORY ================= */
const FIRST_MEET=new Date("2025-09-27");
document.getElementById("meetingText").innerHTML=
  `From our first meet on <b>27 September 2025</b>,<br>
   our love keeps growing.<br><br>
   Itâ€™s been <b>${Math.floor((Date.now()-FIRST_MEET)/(1000*60*60*24))} days</b>,<br>
   and our love is still growing ðŸ’›`;

/* ================= CORE STATE ================= */
let selected=null;
function closeAll(){
  stopAudio();
  stopVideo();
  selected=null;
  controls.target.set(0,0,0);
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
}
window.closeAll=closeAll;

/* ================= SCENE ================= */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,1,30000);
camera.position.set(0,180,360);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.5));
scene.add(new THREE.PointLight(0xffffff,2.5,20000));

const controls=new OrbitControls(camera,renderer.domElement);
controls.enablePan=false;
controls.enableZoom=false;
controls.enableDamping=true;
controls.dampingFactor=0.15;
/* ================= ZOOM ================= */
let zoomTarget = camera.position.distanceTo(controls.target);
let ZOOM_MIN = 120;
let ZOOM_MAX = 6000;
const ZOOM_STEP = 120;
const ZOOM_SMOOTH = 0.08;

window.addEventListener("wheel",(e)=>{
  e.preventDefault();
  zoomTarget += Math.sign(e.deltaY) * ZOOM_STEP;
  zoomTarget = THREE.MathUtils.clamp(zoomTarget, ZOOM_MIN, ZOOM_MAX);
},{passive:false});

/* ================= BACKGROUND STARS ================= */
const bgGeo=new THREE.BufferGeometry(),bg=[];
for(let i=0;i<20000;i++){
  const r=THREE.MathUtils.randFloat(6000,20000);
  const t=Math.random()*Math.PI*2;
  const p=Math.acos(THREE.MathUtils.randFloat(-1,1));
  bg.push(
    r*Math.sin(p)*Math.cos(t),
    r*Math.cos(p),
    r*Math.sin(p)*Math.sin(t)
  );
}
bgGeo.setAttribute("position",new THREE.Float32BufferAttribute(bg,3));
scene.add(new THREE.Points(
  bgGeo,
  new THREE.PointsMaterial({size:1})
));

/* ================= SUN ================= */
const loader=new THREE.TextureLoader();
const sun=new THREE.Mesh(
  new THREE.SphereGeometry(36,64,64),
  new THREE.MeshStandardMaterial({
    map:loader.load("./assets/planets/sun.jpg"),
    emissive:0xffaa00,
    emissiveIntensity:2
  })
);
sun.userData.type="sun";
scene.add(sun);

/* ================= PLANETS ================= */
const planetData=[
 ["Mercury",8,70,1.6,"mercury.jpg","photo01.jpg","star01.mp3"],
 ["Venus",12,110,1.35,"venus.jpg","photo02.jpg","star02.mp3"],
 ["Earth",14,165,1.1,"earth.jpg","photo03.jpg","star03.mp3"],
 ["Mars",12,175,0.95,"mars.jpg","photo04.jpg","star04.mp3"],
 ["Jupiter",26,200,0.6,"jupiter.jpg","photo05.jpg","star05.mp3"],
 ["Saturn",24,260,0.38,"saturn.jpg","photo06.jpg","star06.mp3"],
 ["Uranus",22,320,0.30,"uranus.jpg","photo07.jpg","star07.mp3"],
 ["Neptune",22,380,0.24,"neptune.jpg","photo08.jpg","star08.mp3"],
 ["Pluto",10,440,0.20,"pluto.jpg","photo09.jpg","star09.mp3"],
 ["Eris",10,500,0.16,"eris.jpg","photo10.jpg","star10.mp3"]
];

const planets=[];
planetData.forEach(p=>{
  const mesh=new THREE.Mesh(
    new THREE.SphereGeometry(p[1],48,48),
    new THREE.MeshStandardMaterial({
      map:loader.load("./assets/planets/"+p[4])
    })
  );
  mesh.userData={
    type:"planet",
    info:{
      name:p[0],
      photo:p[5],
      audio:p[6],
      dist:p[2],
      speed:p[3]
    }
  };
  scene.add(mesh);
  planets.push({
    mesh,
    angle:Math.random()*Math.PI*2,
    dist:p[2],
    speed:p[3]
  });
});

/* ================= ORBIT RINGS ================= */
planetData.forEach(p=>{
  const curve=new THREE.EllipseCurve(0,0,p[2],p[2],0,Math.PI*2);
  const pts=curve.getPoints(180);
  const geo=new THREE.BufferGeometry().setFromPoints(
    pts.map(pt=>new THREE.Vector3(pt.x,0,pt.y))
  );
  scene.add(new THREE.Line(
    geo,
    new THREE.LineBasicMaterial({
      opacity:0.12,
      transparent:true
    })
  ));
});
/* ================= MEMORY STARS + HIT AREAS + VIDEOS ================= */
const videos=[
 "./assets/video/video01.mp4",
 "./assets/video/video02.mp4",
 "./assets/video/video03.mp4",
 "./assets/video/video04.mp4",
 "./assets/video/video05.mp4"
];

const memoryStars=[];
const STAR_COLORS=[0x66ccff,0xffcc66,0xff66aa,0x66ffaa,0xcc66ff];
const STAR_RINGS=[
  {radius:720,count:8},
  {radius:900,count:9},
  {radius:1150,count:8}
];

STAR_RINGS.forEach((ring,ri)=>{
  for(let i=0;i<ring.count;i++){
    const star=new THREE.Mesh(
      new THREE.SphereGeometry(8,20,20),
      new THREE.MeshBasicMaterial({
        color:STAR_COLORS[(i+ri)%STAR_COLORS.length]
      })
    );
    star.userData.type="star";
    star.userData.video=videos[memoryStars.length]||null;

    // Invisible hit area
    const hit=new THREE.Mesh(
      new THREE.SphereGeometry(18,16,16),
      new THREE.MeshBasicMaterial({visible:false})
    );
    hit.userData.type="starHit";
    star.add(hit);

    const a=(i/ring.count)*Math.PI*2;
    star.position.set(
      Math.cos(a)*ring.radius,
      THREE.MathUtils.randFloat(-40,40),
      Math.sin(a)*ring.radius
    );

    scene.add(star);
    memoryStars.push(star);
  }
});

/* ================= DUST PARTICLES ================= */
const dustGeo=new THREE.BufferGeometry(),dust=[];
for(let i=0;i<12000;i++){
  const r=THREE.MathUtils.randFloat(80,650);
  const a=Math.random()*Math.PI*2;
  dust.push(
    Math.cos(a)*r,
    THREE.MathUtils.randFloat(-14,14),
    Math.sin(a)*r
  );
}
dustGeo.setAttribute("position",new THREE.Float32BufferAttribute(dust,3));
scene.add(new THREE.Points(
  dustGeo,
  new THREE.PointsMaterial({
    size:0.7,
    opacity:0.4,
    transparent:true,
    depthWrite:false
  })
));

/* ================= SHOOTING STARS ================= */
const shootingStars=[];
function spawnShootingStar(){
  const geo=new THREE.BufferGeometry();
  geo.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,-120],3));
  const mat=new THREE.LineBasicMaterial({
    color:0xffffff,
    transparent:true,
    opacity:1
  });
  const line=new THREE.Line(geo,mat);

  line.position.set(
    THREE.MathUtils.randFloat(-3000,3000),
    THREE.MathUtils.randFloat(200,800),
    THREE.MathUtils.randFloat(-3000,3000)
  );
  line.velocity=new THREE.Vector3(
    THREE.MathUtils.randFloat(-10,-4),
    THREE.MathUtils.randFloat(-6,-2),
    THREE.MathUtils.randFloat(-10,-4)
  );

  scene.add(line);
  shootingStars.push(line);
}
setInterval(spawnShootingStar,6000);

/* ================= COMETS ================= */
const comets=[];
function spawnComet(){
  const head=new THREE.Mesh(
    new THREE.SphereGeometry(2.5,16,16),
    new THREE.MeshBasicMaterial({color:0xffffff})
  );
  const tailPos=[];
  for(let i=0;i<100;i++) tailPos.push(0,0,-i*3);
  const tailGeo=new THREE.BufferGeometry();
  tailGeo.setAttribute("position",new THREE.Float32BufferAttribute(tailPos,3));
  const tail=new THREE.Points(
    tailGeo,
    new THREE.PointsMaterial({
      color:0x88ccff,
      size:2,
      opacity:0.9,
      transparent:true,
      depthWrite:false
    })
  );
  head.add(tail);

  head.position.set(
    THREE.MathUtils.randFloat(-2200,2200),
    THREE.MathUtils.randFloat(-900,900),
    THREE.MathUtils.randFloat(-2200,2200)
  );
  head.velocity=head.position.clone().normalize()
    .multiplyScalar(-THREE.MathUtils.randFloat(8,14));

  scene.add(head);
  comets.push(head);
}
setInterval(spawnComet,7000);

/* ================= RAYCAST ================= */
const raycaster=new THREE.Raycaster();
const mouse=new THREE.Vector2();
let isDragging=false;

renderer.domElement.addEventListener("pointerdown",()=>isDragging=false);
renderer.domElement.addEventListener("pointermove",()=>isDragging=true);

/* ---- SINGLE CLICK (ZOOM / SUN / RESET) ---- */
window.addEventListener("click",(e)=>{
  if(isDragging) return;

  stopAudio();
  stopVideo();

  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);

  const hits=raycaster.intersectObjects(
    [sun,...planets.map(p=>p.mesh),...memoryStars],
    true
  );

  if(hits.length){
    let obj=hits[0].object;
    if(obj.userData.type==="starHit") obj=obj.parent;

    if(obj.userData.type==="sun"){
      closeAll();
      document.getElementById("sunModal").style.display="flex";
      return;
    }

    selected=obj;
    ZOOM_MIN = 60;
    ZOOM_MAX = 3000;
  }else{
    closeAll();
    zoomTarget = camera.position.distanceTo(controls.target);
    ZOOM_MIN = 120;
    ZOOM_MAX = 6000;
  }
});

/* ---- DOUBLE CLICK (PLANET PHOTO / AUDIO / STAR VIDEO) ---- */
window.addEventListener("dblclick",(e)=>{
  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);

  const hits=raycaster.intersectObjects(
    [...planets.map(p=>p.mesh),...memoryStars],
    true
  );
  if(!hits.length) return;

  let obj=hits[0].object;
  if(obj.userData.type==="starHit") obj=obj.parent;

  if(obj.userData.type==="planet"){
    const i=obj.userData.info;
    document.getElementById("planetTitle").innerText=i.name;
    document.getElementById("planetImg").src="./assets/photos/"+i.photo;
    document.getElementById("planetModal").style.display="flex";
    playAudio("./assets/audio/"+i.audio);
  }

  if(obj.userData.type==="star" && obj.userData.video){
    playVideo(obj.userData.video);
  }
});

/* ================= ANIMATION LOOP ================= */
function animate(){
  requestAnimationFrame(animate);

  planets.forEach(p=>{
    p.angle+=0.00035*p.speed;
    p.mesh.position.set(
      Math.cos(p.angle)*p.dist,
      0,
      Math.sin(p.angle)*p.dist
    );
  });

  comets.forEach((c,i)=>{
    c.position.add(c.velocity);
    c.children[0].material.opacity-=0.003;
    if(c.children[0].material.opacity<=0){
      scene.remove(c);
      comets.splice(i,1);
    }
  });

  shootingStars.forEach((s,i)=>{
    s.position.add(s.velocity);
    s.material.opacity-=0.01;
    if(s.material.opacity<=0){
      scene.remove(s);
      shootingStars.splice(i,1);
    }
  });

  if(selected){
    controls.target.copy(selected.position);
  }

const dir = camera.position.clone()
  .sub(controls.target)
  .normalize();

const dist = camera.position.distanceTo(controls.target);

camera.position.copy(
  controls.target.clone().add(
    dir.multiplyScalar(
      THREE.MathUtils.lerp(dist, zoomTarget, ZOOM_SMOOTH)
    )
  )
);

controls.update();
renderer.render(scene,camera);

}
animate();

/* ================= RESIZE ================= */
window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
