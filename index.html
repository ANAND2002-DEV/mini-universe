<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Universe ‚Äì Deep Zoom</title>

<style>
  body { margin:0; overflow:hidden; background:black; }
  canvas { display:block; }
  .label {
    position:absolute;
    color:white;
    font-size:13px;
    background:rgba(0,0,0,0.65);
    padding:4px 8px;
    border-radius:5px;
    pointer-events:none;
    display:none;
    transform:translate(-50%,-50%);
  }
</style>
</head>
<body>

<div id="label" class="label"></div>

<script type="module">
import * as THREE from './three/three.module.min.js';
import { OrbitControls } from './three/OrbitControls.js';

/* ---------------- SCENE ---------------- */
const scene = new THREE.Scene();

/* ---------------- CAMERA ---------------- */
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 8000);
camera.position.set(0, 160, 420);

/* ---------------- RENDERER ---------------- */
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* ---------------- CONTROLS ---------------- */
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.minDistance = 12;       // üîç very close zoom
controls.maxDistance = 3000;     // üåå very far zoom
controls.zoomSpeed = 1.6;

/* ---------------- LIGHT ---------------- */
scene.add(new THREE.AmbientLight(0xffffff, 0.45));

const sunLight = new THREE.PointLight(0xffffff, 4, 5000);
scene.add(sunLight);

/* ---------------- STARFIELD ---------------- */
const starGeo = new THREE.BufferGeometry();
const stars = [];
for (let i = 0; i < 12000; i++) {
  stars.push(
    (Math.random()-0.5)*5000,
    (Math.random()-0.5)*5000,
    (Math.random()-0.5)*5000
  );
}
starGeo.setAttribute('position', new THREE.Float32BufferAttribute(stars,3));
scene.add(new THREE.Points(
  starGeo,
  new THREE.PointsMaterial({ color:0xffffff, size:1 })
));

/* ---------------- TEXTURES ---------------- */
const loader = new THREE.TextureLoader();

/* ---------------- SUN ---------------- */
const sun = new THREE.Mesh(
  new THREE.SphereGeometry(22,64,64),
  new THREE.MeshBasicMaterial({
    map: loader.load('./assets/planets/sun.jpg')
  })
);
scene.add(sun);

/* ---------------- PLANETS DATA ---------------- */
const planetData = [
  {name:'Mercury', tex:'mercury.jpg', r:3.2, d:45, speed:0.05, moons:0},
  {name:'Venus', tex:'venus.jpg', r:4.5, d:62, speed:0.04, moons:0},
  {name:'Earth', tex:'earth.jpg', r:5, d:85, speed:0.035, moons:1},
  {name:'Mars', tex:'mars.jpg', r:4, d:110, speed:0.03, moons:2},
  {name:'Jupiter', tex:'jupiter.jpg', r:11, d:160, speed:0.02, moons:4},
  {name:'Saturn', tex:'saturn.jpg', r:9.5, d:210, speed:0.017, moons:3},
  {name:'Uranus', tex:'uranus.jpg', r:7, d:260, speed:0.013, moons:2},
  {name:'Neptune', tex:'neptune.jpg', r:7, d:310, speed:0.01, moons:2},
  {name:'Pluto', tex:'pluto.jpg', r:3, d:360, speed:0.008, moons:1},
  {name:'Exoplanet', tex:'exoplanet.jpg', r:5.5, d:420, speed:0.006, moons:2}
];

const planetMeshes = [];
const systems = [];

/* ---------------- CREATE PLANETS ---------------- */
planetData.forEach(p => {

  const orbit = new THREE.Object3D();
  orbit.rotation.y = Math.random()*Math.PI*2;
  orbit.rotation.x = (Math.random()-0.5)*0.35;
  scene.add(orbit);

  const planet = new THREE.Mesh(
    new THREE.SphereGeometry(p.r, 32, 32),
    new THREE.MeshStandardMaterial({
      map: loader.load('./assets/planets/'+p.tex),
      roughness:0.7,
      metalness:0,
      emissiveIntensity:0.4
    })
  );

  planet.position.x = p.d;
  planet.userData.name = p.name;
  orbit.add(planet);

  /* -------- MOONS (BRIGHTER) -------- */
  const moonPivots = [];
  for(let i=0;i<p.moons;i++){
    const pivot = new THREE.Object3D();
    planet.add(pivot);

    const moon = new THREE.Mesh(
      new THREE.SphereGeometry(1.2,16,16),
      new THREE.MeshStandardMaterial({
        color:0xffffff,
        emissive:0xffffff,
        emissiveIntensity:0.35
      })
    );

    moon.position.x = 7 + i*3;
    pivot.rotation.y = Math.random()*Math.PI*2;
    pivot.add(moon);
    moonPivots.push(pivot);
  }

  systems.push({orbit, speed:p.speed, moonPivots});
  planetMeshes.push(planet);
});

/* ---------------- CLICK TO FOCUS ---------------- */
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
const label = document.getElementById('label');

addEventListener('click', e=>{
  mouse.x = (e.clientX/innerWidth)*2 - 1;
  mouse.y = -(e.clientY/innerHeight)*2 + 1;
  raycaster.setFromCamera(mouse,camera);
  const hit = raycaster.intersectObjects(planetMeshes);
  if(hit.length){
    controls.target.copy(hit[0].object.getWorldPosition(new THREE.Vector3()));
    label.innerText = hit[0].object.userData.name;
    label.style.display = 'block';
  }
});

/* ---------------- LABEL FOLLOW ---------------- */
function updateLabel(){
  if(label.style.display==='none') return;
  const p = controls.target.clone().project(camera);
  label.style.left = ((p.x+1)/2)*innerWidth+'px';
  label.style.top = ((-p.y+1)/2)*innerHeight+'px';
}

/* ---------------- ANIMATE ---------------- */
function animate(){
  requestAnimationFrame(animate);

  systems.forEach(s=>{
    s.orbit.rotation.y += s.speed*0.01;
    s.moonPivots.forEach(m=> m.rotation.y += 0.015);
  });

  controls.update();
  updateLabel();
  renderer.render(scene,camera);
}
animate();

/* ---------------- RESIZE ---------------- */
addEventListener('resize',()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>
