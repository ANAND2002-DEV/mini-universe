<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Universe – NASA Style</title>
<style>
  body { margin:0; overflow:hidden; background:black; }
  canvas { display:block; }
  #ui {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: #aaa;
    font-size: 13px;
    font-family: Arial;
  }
</style>
</head>
<body>

<div id="ui">Click planet to focus • Click Sun to return</div>

<script type="module">
import * as THREE from './three/three.module.min.js';
import { OrbitControls } from './three/OrbitControls.js';

/* ---------------- SCENE ---------------- */
const scene = new THREE.Scene();

/* ---------------- CAMERA ---------------- */
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 10000);
camera.position.set(0, 200, 500);

/* ---------------- RENDERER ---------------- */
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* ---------------- CONTROLS ---------------- */
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.08;

/* ---------------- LIGHT ---------------- */
scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const sunLight = new THREE.PointLight(0xffffff, 3, 8000);
scene.add(sunLight);

/* ---------------- TEXTURES ---------------- */
const loader = new THREE.TextureLoader();

/* ---------------- CAMERA MODE ---------------- */
let mode = 'solar'; // 'solar' | 'planet'
let focusedPlanet = null;

/* ---------------- SUN ---------------- */
const sun = new THREE.Mesh(
  new THREE.SphereGeometry(35,64,64),
  new THREE.MeshBasicMaterial({
    map: loader.load('./assets/planets/sun.jpg')
  })
);
scene.add(sun);

/* ---------------- PLANETS ---------------- */
const planetData = [
  {name:'Mercury', file:'mercury.jpg', size:8,  dist:80,  speed:0.02},
  {name:'Venus',   file:'venus.jpg',   size:12, dist:120, speed:0.015},
  {name:'Earth',   file:'earth.jpg',   size:14, dist:170, speed:0.012},
  {name:'Mars',    file:'mars.jpg',    size:11, dist:220, speed:0.01},
  {name:'Jupiter', file:'jupiter.jpg', size:26, dist:300, speed:0.006},
  {name:'Saturn',  file:'saturn.jpg',  size:23, dist:380, speed:0.005},
  {name:'Uranus',  file:'uranus.jpg',  size:19, dist:460, speed:0.004},
  {name:'Neptune', file:'neptune.jpg', size:19, dist:540, speed:0.003},
  {name:'Pluto',   file:'pluto.jpg',   size:7,  dist:620, speed:0.002},
  {name:'Exoplanet', file:'exoplanet.jpg', size:15, dist:700, speed:0.0015}
];

const pivots = [];
const planets = [];

planetData.forEach(p => {
  const pivot = new THREE.Object3D();
  scene.add(pivot);
  pivots.push(pivot);

  const planet = new THREE.Mesh(
    new THREE.SphereGeometry(p.size, 64, 64),
    new THREE.MeshStandardMaterial({
      map: loader.load('./assets/planets/' + p.file),
      roughness: 0.4
    })
  );

  planet.position.x = p.dist;
  planet.userData = p;
  pivot.add(planet);
  planets.push(planet);
});

/* ---------------- NASA STYLE FOCUS ---------------- */
function focusOnPlanet(planet) {
  mode = 'planet';
  focusedPlanet = planet;

  controls.minDistance = planet.userData.size * 1.2;
  controls.maxDistance = planet.userData.size * 15;

  const target = planet.getWorldPosition(new THREE.Vector3());
  controls.target.copy(target);

  const dir = new THREE.Vector3(1, 0.4, 1).normalize();
  camera.position.copy(
    target.clone().add(dir.multiplyScalar(planet.userData.size * 5))
  );
}

function returnToSolar() {
  mode = 'solar';
  focusedPlanet = null;

  controls.minDistance = 50;
  controls.maxDistance = 5000;

  controls.target.set(0,0,0);
  camera.position.set(0, 200, 500);
}

/* ---------------- CLICK HANDLER ---------------- */
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

window.addEventListener('click', e => {
  mouse.x = (e.clientX / innerWidth) * 2 - 1;
  mouse.y = -(e.clientY / innerHeight) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);

  const hitPlanet = raycaster.intersectObjects(planets);
  if (hitPlanet.length) {
    focusOnPlanet(hitPlanet[0].object);
    return;
  }

  const hitSun = raycaster.intersectObject(sun);
  if (hitSun.length) {
    returnToSolar();
  }
});

/* ---------------- ANIMATION ---------------- */
function animate() {
  requestAnimationFrame(animate);

  pivots.forEach((p,i)=>{
    p.rotation.y += planetData[i].speed;
  });

  controls.update();
  renderer.render(scene,camera);
}
animate();

/* ---------------- RESIZE ---------------- */
addEventListener('resize',()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>

</body>
</html>
