<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Universe â€” MAIN BASE</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  font-family:Arial, sans-serif;
  touch-action:none;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.modal-card{
  background:#0b0b0b;
  border-radius:16px;
  padding:24px;
  max-width:420px;
  text-align:center;
  color:#fff;
}
.modal-card img{
  width:100%;
  border-radius:12px;
  margin-bottom:12px;
}
.close-btn{
  cursor:pointer;
  opacity:0.8;
  margin-top:10px;
}
#sunModal .modal-card{
  border:1px solid rgba(255,200,80,0.5);
  color:#ffd27d;
}
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
  }
}
</script>
</head>

<body>

<!-- SUN MEMORY -->
<div id="sunModal" class="modal">
  <div class="modal-card">
    <h2>ðŸŒž Our First Meeting</h2>
    <p id="meetingText"></p>
    <div class="close-btn" onclick="closeAll()">Close</div>
  </div>
</div>

<!-- PLANET MODAL -->
<div id="planetModal" class="modal">
  <div class="modal-card">
    <h2 id="planetTitle"></h2>
    <img id="planetImg">
    <div class="close-btn" onclick="closeAll()">Close</div>
  </div>
</div>

<script type="module">
import * as THREE from "three";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js";

/* ================= AUDIO ================= */
let currentAudio=null;
function playAudio(src){
  stopAudio();
  currentAudio=new Audio(src);
  currentAudio.loop=true;
  currentAudio.volume=0.7;
  currentAudio.play();
}
function stopAudio(){
  if(currentAudio){
    currentAudio.pause();
    currentAudio.currentTime=0;
    currentAudio=null;
  }
}

/* ================= SUN MEMORY ================= */
const FIRST_MEET=new Date("2025-09-27");
document.getElementById("meetingText").innerHTML=
`From our first meet on <b>27 September 2025</b>,<br>
our love keeps growing.<br><br>
Itâ€™s been <b>${Math.floor((Date.now()-FIRST_MEET)/(1000*60*60*24))} days</b>,<br>
and our love is still growing ðŸ’›`;

/* ================= SCENE ================= */
const scene=new THREE.Scene();

/* CAMERA */
const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,1,30000);
camera.position.set(0,180,360);

/* RENDERER */
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* LIGHT */
scene.add(new THREE.AmbientLight(0xffffff,0.5));
scene.add(new THREE.PointLight(0xffffff,2.5,20000));

/* CONTROLS */
const controls=new OrbitControls(camera,renderer.domElement);
controls.enablePan=false;
controls.enableZoom=false;
controls.enableDamping=true;
controls.dampingFactor=0.15;

/* SELECTION */
let selected=null;
function closeAll(){
  stopAudio();
  selected=null;
  controls.target.set(0,0,0);
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
}
window.closeAll=closeAll;

/* ZOOM CORE */
let zoomTarget=camera.position.distanceTo(controls.target);
let ZOOM_MIN=120, ZOOM_MAX=6000;
const ZOOM_STEP=120, ZOOM_SMOOTH=0.08;

/* DESKTOP ZOOM */
window.addEventListener("wheel",(e)=>{
  e.preventDefault();
  zoomTarget+=Math.sign(e.deltaY)*ZOOM_STEP;
  zoomTarget=THREE.MathUtils.clamp(zoomTarget,ZOOM_MIN,ZOOM_MAX);
},{passive:false});

/* MOBILE PINCH ZOOM */
let lastPinch=null;
renderer.domElement.addEventListener("touchstart",e=>{
  if(e.touches.length===2){
    const dx=e.touches[0].clientX-e.touches[1].clientX;
    const dy=e.touches[0].clientY-e.touches[1].clientY;
    lastPinch=Math.hypot(dx,dy);
  }
},{passive:false});

renderer.domElement.addEventListener("touchmove",e=>{
  if(e.touches.length===2 && lastPinch){
    e.preventDefault();
    const dx=e.touches[0].clientX-e.touches[1].clientX;
    const dy=e.touches[0].clientY-e.touches[1].clientY;
    const dist=Math.hypot(dx,dy);
    zoomTarget+= (lastPinch-dist)*0.8;
    zoomTarget=THREE.MathUtils.clamp(zoomTarget,ZOOM_MIN,ZOOM_MAX);
    lastPinch=dist;
  }
},{passive:false});

renderer.domElement.addEventListener("touchend",()=>lastPinch=null);

/* BACKGROUND STARS */
const bgGeo=new THREE.BufferGeometry();
const bg=[];
for(let i=0;i<18000;i++){
  const r=THREE.MathUtils.randFloat(6000,20000);
  const t=Math.random()*Math.PI*2;
  const p=Math.acos(THREE.MathUtils.randFloat(-1,1));
  bg.push(r*Math.sin(p)*Math.cos(t),r*Math.cos(p),r*Math.sin(p)*Math.sin(t));
}
bgGeo.setAttribute("position",new THREE.Float32BufferAttribute(bg,3));
scene.add(new THREE.Points(bgGeo,new THREE.PointsMaterial({size:1})));

/* SUN */
const loader=new THREE.TextureLoader();
const sun=new THREE.Mesh(
  new THREE.SphereGeometry(36,64,64),
  new THREE.MeshStandardMaterial({
    map:loader.load("./assets/planets/sun.jpg"),
    emissive:0xffaa00,
    emissiveIntensity:2
  })
);
sun.userData.type="sun";
scene.add(sun);

/* PLANETS */
const planetData=[
 ["Mercury",8,70,1.8,"mercury.jpg","photo01.jpg","star01.mp3"],
 ["Venus",12,95,1.5,"venus.jpg","photo02.jpg","star02.mp3"],
 ["Earth",14,120,1.2,"earth.jpg","photo03.jpg","star03.mp3"],
 ["Mars",12,150,1.0,"mars.jpg","photo04.jpg","star04.mp3"],
 ["Jupiter",26,200,0.7,"jupiter.jpg","photo05.jpg","star05.mp3"],
 ["Saturn",24,260,0.45,"saturn.jpg","photo06.jpg","star06.mp3"],
 ["Uranus",22,320,0.35,"uranus.jpg","photo07.jpg","star07.mp3"],
 ["Neptune",22,380,0.28,"neptune.jpg","photo08.jpg","star08.mp3"],
 ["Pluto",10,440,0.22,"pluto.jpg","photo09.jpg","star09.mp3"],
 ["Eris",10,500,0.18,"eris.jpg","photo10.jpg","star10.mp3"]
];

const planets=[];
planetData.forEach(p=>{
  const mesh=new THREE.Mesh(
    new THREE.SphereGeometry(p[1],48,48),
    new THREE.MeshStandardMaterial({map:loader.load("./assets/planets/"+p[4])})
  );
  mesh.userData={type:"planet",info:{name:p[0],photo:p[5],audio:p[6]}};
  mesh.angle=Math.random()*Math.PI*2;
  mesh.dist=p[2];
  mesh.speed=p[3];
  scene.add(mesh);
  planets.push(mesh);
});

/* RAYCAST */
const raycaster=new THREE.Raycaster();
const mouse=new THREE.Vector2();

window.addEventListener("click",e=>{
  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);

  const hits=raycaster.intersectObjects([sun,...planets]);
  if(hits.length){
    const obj=hits[0].object;
    if(obj.userData.type==="sun"){
      closeAll();
      document.getElementById("sunModal").style.display="flex";
      return;
    }
    selected=obj;
    zoomTarget=obj.position.length()*0.9;
    ZOOM_MIN=60; ZOOM_MAX=3000;
  }else{
    closeAll();
    ZOOM_MIN=120; ZOOM_MAX=6000;
  }
});

window.addEventListener("dblclick",e=>{
  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const hit=raycaster.intersectObjects(planets)[0];
  if(!hit) return;
  const info=hit.object.userData.info;
  document.getElementById("planetTitle").innerText=info.name;
  document.getElementById("planetImg").src="./assets/photos/"+info.photo;
  document.getElementById("planetModal").style.display="flex";
  playAudio("./assets/audio/"+info.audio);
});

/* ANIMATE */
function animate(){
  requestAnimationFrame(animate);

  planets.forEach(p=>{
    p.angle+=0.00035*p.speed;
    p.position.set(Math.cos(p.angle)*p.dist,0,Math.sin(p.angle)*p.dist);
  });

  if(selected) controls.target.copy(selected.position);

  const dir=camera.position.clone().sub(controls.target).normalize();
  const dist=camera.position.distanceTo(controls.target);
  camera.position.copy(
    controls.target.clone().add(
      dir.multiplyScalar(THREE.MathUtils.lerp(dist,zoomTarget,ZOOM_SMOOTH))
    )
  );

  controls.update();
  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
