<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Universe</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; }
</style>
</head>
<body>

<script type="module">
import * as THREE from "./three/three.module.min.js";

/* ================= SCENE ================= */
const scene = new THREE.Scene();

/* ================= CAMERA ================= */
const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 15000);
let theta=Math.PI/4, phi=Math.PI/3;
let radius=120, tTheta=theta, tPhi=phi, tRadius=radius;
let focus=null;

function getFocus(){
  if(focus){
    const v=new THREE.Vector3();
    focus.getWorldPosition(v);
    return v;
  }
  return new THREE.Vector3();
}

function updateCamera(){
  theta+=(tTheta-theta)*0.08;
  phi+=(tPhi-phi)*0.08;
  radius+=(tRadius-radius)*0.15;
  const f=getFocus();
  camera.position.set(
    f.x + radius*Math.sin(phi)*Math.sin(theta),
    f.y + radius*Math.cos(phi),
    f.z + radius*Math.sin(phi)*Math.cos(theta)
  );
  camera.lookAt(f);
}

/* ================= RENDERER ================= */
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.outputEncoding=THREE.sRGBEncoding;
renderer.toneMapping=THREE.ACESFilmicToneMapping;
document.body.appendChild(renderer.domElement);

/* ================= LIGHTS ================= */
scene.add(new THREE.PointLight(0xffffff,180,0,2));
scene.add(new THREE.AmbientLight(0xffffff,0.6));

/* ================= STARFIELD ================= */
const starsGeo=new THREE.BufferGeometry();
const stars=[];
for(let i=0;i<9000;i++){
  stars.push(
    (Math.random()-0.5)*9000,
    (Math.random()-0.5)*9000,
    (Math.random()-0.5)*9000
  );
}
starsGeo.setAttribute("position",new THREE.Float32BufferAttribute(stars,3));
scene.add(new THREE.Points(
  starsGeo,
  new THREE.PointsMaterial({size:1.4,color:0xffffff})
));

/* ================= TEXTURES ================= */
const loader=new THREE.TextureLoader();

/* ================= SUN ================= */
const sun=new THREE.Mesh(
  new THREE.SphereGeometry(8,64,64),
  new THREE.MeshBasicMaterial({map:loader.load("./assets/planets/sun.jpg")})
);
scene.add(sun);

/* ================= LABEL SYSTEM ================= */
function makeLabel(text){
  const canvas=document.createElement("canvas");
  canvas.width=256; canvas.height=64;
  const ctx=canvas.getContext("2d");
  ctx.fillStyle="rgba(0,0,0,0.6)";
  ctx.fillRect(0,0,256,64);
  ctx.fillStyle="white";
  ctx.font="28px Arial";
  ctx.textAlign="center";
  ctx.fillText(text,128,42);
  const tex=new THREE.CanvasTexture(canvas);
  return new THREE.Sprite(
    new THREE.SpriteMaterial({map:tex,transparent:true})
  );
}

/* ================= PLANETS ================= */
const planetData=[
 {name:"Mercury",size:1.2,dist:18,speed:0.0009,tex:"mercury.jpg"},
 {name:"Venus",size:1.6,dist:24,speed:0.0007,tex:"venus.jpg"},
 {name:"Earth",size:1.8,dist:30,speed:0.0006,tex:"earth.jpg",moons:1},
 {name:"Mars",size:1.5,dist:36,speed:0.0005,tex:"mars.jpg"},
 {name:"Jupiter",size:3.2,dist:48,speed:0.0003,tex:"jupiter.jpg",moons:3},
 {name:"Saturn",size:2.9,dist:62,speed:0.00025,tex:"saturn.jpg",moons:2},
 {name:"Uranus",size:2.5,dist:76,speed:0.0002,tex:"uranus.jpg"},
 {name:"Neptune",size:2.5,dist:90,speed:0.00015,tex:"neptune.jpg"},
 {name:"Pluto",size:1.2,dist:104,speed:0.0001,tex:"pluto.jpg"},
 {name:"Exoplanet",size:2.0,dist:120,speed:0.00008,tex:"exoplanet.jpg"}
];

const planets=[], clickable=[], labels=[];

planetData.forEach(p=>{
  /* orbit ring */
  const ring=new THREE.Mesh(
    new THREE.RingGeometry(p.dist-0.12,p.dist+0.12,128),
    new THREE.MeshBasicMaterial({
      color:0xffffff,
      opacity:0.16,
      transparent:true,
      depthWrite:false
    })
  );
  ring.rotation.x=Math.PI/2;
  scene.add(ring);

  const pivot=new THREE.Object3D();
  pivot.rotation.y=Math.random()*Math.PI*2;
  scene.add(pivot);

  const planet=new THREE.Mesh(
    new THREE.SphereGeometry(p.size,48,48),
    new THREE.MeshStandardMaterial({
      map:loader.load("./assets/planets/"+p.tex),
      emissive:0x333333,
      emissiveIntensity:0.5
    })
  );
  planet.position.x=p.dist;
  pivot.add(planet);

  /* label */
  const label=makeLabel(p.name);
  label.position.set(0,p.size*1.6,0);
  label.scale.set(8,2,1);
  label.visible=false;
  planet.add(label);

  /* moons */
  const moonPivots=[];
  if(p.moons){
    for(let i=0;i<p.moons;i++){
      const mp=new THREE.Object3D();
      planet.add(mp);
      const moon=new THREE.Mesh(
        new THREE.SphereGeometry(p.size*0.18,24,24),
        new THREE.MeshStandardMaterial({color:0xffffff})
      );
      moon.position.x=p.size*(2.2+i*0.9);
      mp.add(moon);
      moonPivots.push(mp);
    }
  }

  planets.push({pivot,planet,moons:moonPivots,label,speed:p.speed});
  clickable.push(planet);
  labels.push(label);
});

/* ================= COMET ================= */
const cometPivot=new THREE.Object3D();
scene.add(cometPivot);

const comet=new THREE.Mesh(
  new THREE.SphereGeometry(0.6,16,16),
  new THREE.MeshBasicMaterial({color:0xffffff})
);
comet.position.x=160;
cometPivot.add(comet);

/* tail */
const tailGeo=new THREE.BufferGeometry();
const tailPos=[];
for(let i=0;i<60;i++) tailPos.push(-i*0.6,0,0);
tailGeo.setAttribute("position",new THREE.Float32BufferAttribute(tailPos,3));
const tail=new THREE.Line(
  tailGeo,
  new THREE.LineBasicMaterial({color:0x88ccff,transparent:true,opacity:0.6})
);
comet.add(tail);

/* ================= INTERACTION ================= */
const raycaster=new THREE.Raycaster();
const mouse=new THREE.Vector2();
let lockedLabel=null;

addEventListener("mousemove",e=>{
  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const hit=raycaster.intersectObjects(clickable);
  labels.forEach(l=>{ if(l!==lockedLabel) l.visible=false; });
  if(hit.length && !lockedLabel){
    hit[0].object.children.forEach(c=>{ if(c.type==="Sprite") c.visible=true; });
  }
});

addEventListener("click",e=>{
  raycaster.setFromCamera(mouse,camera);
  const hit=raycaster.intersectObjects(clickable);
  if(hit.length){
    focus=hit[0].object;
    lockedLabel=hit[0].object.children.find(c=>c.type==="Sprite");
    lockedLabel.visible=true;
    tRadius=hit[0].object.geometry.parameters.radius*2;
  } else {
    lockedLabel=null;
  }
});

/* ================= CONTROLS ================= */
let drag=false,lx=0,ly=0;
addEventListener("mousedown",e=>{drag=true;lx=e.clientX;ly=e.clientY});
addEventListener("mouseup",()=>drag=false);
addEventListener("mousemove",e=>{
  if(!drag)return;
  tTheta-=(e.clientX-lx)*0.004;
  tPhi-=(e.clientY-ly)*0.004;
  tPhi=Math.max(0.3,Math.min(Math.PI-0.3,tPhi));
  lx=e.clientX;ly=e.clientY;
});
addEventListener("wheel",e=>{
  tRadius+=e.deltaY*0.08;
  tRadius=Math.max(1,Math.min(2500,tRadius));
});

/* ================= ANIMATE ================= */
function animate(){
  requestAnimationFrame(animate);
  updateCamera();
  sun.rotation.y+=0.00025;

  planets.forEach(p=>{
    p.pivot.rotation.y+=p.speed;
    p.planet.rotation.y+=0.0007;
    p.moons.forEach((m,i)=>m.rotation.y+=0.001+i*0.0005);
  });

  cometPivot.rotation.y+=0.00015;

  renderer.render(scene,camera);
}
animate();

/* ================= RESIZE ================= */
addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>

